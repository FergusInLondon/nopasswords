"use strict";var NoPasswordsSRP=(()=>{var l=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var G=Object.getOwnPropertyNames;var P=Object.prototype.hasOwnProperty;var R=(r,t)=>{for(var n in t)l(r,n,{get:t[n],enumerable:!0})},_=(r,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of G(t))!P.call(r,e)&&e!==n&&l(r,e,{get:()=>t[e],enumerable:!(s=v(t,e))||s.enumerable});return r};var k=r=>_(l({},"__esModule",{value:!0}),r);var K={};R(K,{SRPClient:()=>g,bigIntToBytes:()=>F,bytesToBigInt:()=>c,computeK:()=>h,getGroup:()=>a,padBytes:()=>E});function a(r){switch(r){case 3:return M();case 4:return L();case 5:return q();default:throw new Error(`Invalid group ID: ${r} (valid: 3, 4, 5)`)}}function M(){let r=BigInt("0xAC6BDB41324A9A9BF166DE5E1389582FAF72B6651987EE07FC3192943DB56050A37329CBB4A099ED8193E0757767A13DD52312AB4B03310DCD7F48A9DA04FD50E8083969EDB767B0CF6095179A163AB3661A05FBD5FAAAE82918A9962F0B93B855F97993EC975EEAA80D740ADBF4FF747359D041D5C33EA71D281E446B14773BCA97B43A23FB801676BD207A436C6481F1D2B9078717461A5B9D32E688F87748544523B524B0D57D5EA77A2775D2ECFA032CFBDBF52FB3786160279004E57AE6AF874E7303CE53299CCC041C7BC308D82A5698F3A8D0C38271AE35F8E9DBFBB694B5C803D89F7AE435DE236D525F54759B65E372FCD68EF20FA7111F9E4AFF73"),t=BigInt(2);return{N:r,g:t,bitLength:2048}}function L(){let r=BigInt("0xFFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF"),t=BigInt(5);return{N:r,g:t,bitLength:3072}}function q(){let r=BigInt("0xFFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A92108011A723C12A787E6D788719A10BDBA5B2699C327186AF4E23C1A946834B6150BDA2583E9CA2AD44CE8DBBBC2DB04DE8EF92E8EFC141FBECAA6287C59474E6BC05D99B2964FA090C3A2233BA186515BE7ED1F612970CEE2D7AFB81BDD762170481CD0069127D5B05AA993B4EA988D8FDDC186FFB7DC90A6C08F4DF435C934063199FFFFFFFFFFFFFFFF"),t=BigInt(5);return{N:r,g:t,bitLength:4096}}async function h(r){let t=F(r.N),n=F(r.g),s=new Uint8Array(t.length);s.set(n,s.length-n.length);let e=new Uint8Array(t.length+s.length);e.set(t,0),e.set(s,t.length);let o=await crypto.subtle.digest("SHA-256",e),A=new Uint8Array(o);return c(A)}function F(r){let t=r.toString(16),n=t.length%2===0?t:"0"+t,s=new Uint8Array(n.length/2);for(let e=0;e<s.length;e++)s[e]=parseInt(n.substr(e*2,2),16);return s}function c(r){let t="";for(let n=0;n<r.length;n++){let s=r[n].toString(16).padStart(2,"0");t+=s}return BigInt("0x"+t)}function E(r,t){if(r.length>=t)return r;let n=new Uint8Array(t);return n.set(r,t-r.length),n}var g=class{constructor(t){this.config=t}async register(t,n){try{let s=a(this.config.group),e=new Uint8Array(32);crypto.getRandomValues(e);let o=await this.computeX(t,n,e),A=this.modPow(s.g,o,s.N),B={user_id:t,salt:this.bytesToBase64(e),verifier:this.bytesToBase64(F(A)),group:this.config.group},i=await this.post("/api/srp/register",B);return{success:i.success,userID:i.user_id,error:i.error}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}async authenticate(t,n){try{let s={user_id:t,group:this.config.group},e=await this.post("/api/srp/authenticate/begin",s),o=this.base64ToBytes(e.salt),A=c(this.base64ToBytes(e.b)),B=a(e.group),i=await this.computeX(t,n,o),y=new Uint8Array(32);crypto.getRandomValues(y);let f=c(y),C=this.modPow(B.g,f,B.N),w=await this.computeU(C,A,B),m=await h(B),b=this.modPow(B.g,i,B.N),T=m*b%B.N,u=(A-T)%B.N;u<0n&&(u+=B.N);let x=w*i,U=f+x,S=this.modPow(u,U,B.N),p=await this.hashSHA256(F(S)),d=await this.computeM1(C,A,p),N={user_id:t,a:this.bytesToBase64(F(C)),m1:this.bytesToBase64(d)},D=await this.post("/api/srp/authenticate/finish",N);if(!D.success)return{success:!1,error:D.error||"Authentication failed"};if(D.m2){let H=await this.computeM2(C,d,p),I=this.base64ToBytes(D.m2);if(!this.constantTimeCompare(H,I))return{success:!1,error:"Server proof verification failed"}}return{success:!0,sessionKey:p}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown error"}}}async computeX(t,n,s){let e=t+":"+n,o=new TextEncoder().encode(e),A=await this.hashSHA256(o),B=new Uint8Array(s.length+A.length);B.set(s,0),B.set(A,s.length);let i=await this.hashSHA256(B);return c(i)}async computeU(t,n,s){let e=F(s.N),o=E(F(t),e.length),A=E(F(n),e.length),B=new Uint8Array(o.length+A.length);B.set(o,0),B.set(A,o.length);let i=await this.hashSHA256(B);return c(i)}async computeM1(t,n,s){let e=F(t),o=F(n),A=new Uint8Array(e.length+o.length+s.length);return A.set(e,0),A.set(o,e.length),A.set(s,e.length+o.length),this.hashSHA256(A)}async computeM2(t,n,s){let e=F(t),o=new Uint8Array(e.length+n.length+s.length);return o.set(e,0),o.set(n,e.length),o.set(s,e.length+n.length),this.hashSHA256(o)}async hashSHA256(t){let n=await crypto.subtle.digest("SHA-256",new Uint8Array(t));return new Uint8Array(n)}modPow(t,n,s){let e=1n;for(t=t%s;n>0n;)n%2n===1n&&(e=e*t%s),n=n/2n,t=t*t%s;return e}constantTimeCompare(t,n){if(t.length!==n.length)return!1;let s=0;for(let e=0;e<t.length;e++)s|=t[e]^n[e];return s===0}bytesToBase64(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}base64ToBytes(t){let n=t.replace(/-/g,"+").replace(/_/g,"/"),s=n+"====".slice(0,(4-n.length%4)%4),e=atob(s),o=new Uint8Array(e.length);for(let A=0;A<e.length;A++)o[A]=e.charCodeAt(A);return o}async post(t,n){let s=this.config.baseURL+t,e=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);return e.json()}};return k(K);})();
//# sourceMappingURL=nopasswords-srp.js.map
